<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Japan TV Streaming</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(120deg, #1a1a2e, #16213e);
      color: #fff;
      margin: 0;
      padding: 0;
    }
    header {
      background: #0f3460;
      padding: 15px;
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      letter-spacing: 1px;
    }
    .tabs {
      display: flex;
      justify-content: center;
      background: #1a1a2e;
      border-bottom: 2px solid #4ecdc4;
      flex-wrap: wrap;
    }
    .tab {
      padding: 10px 16px;
      cursor: pointer;
      color: #fff;
      transition: 0.3s;
      margin: 2px;
      border-radius: 6px;
    }
    .tab:hover, .tab.active {
      background: #4ecdc4;
      color: #000;
      font-weight: bold;
    }
    .content {
      padding: 15px;
    }
    .content-section {
      display: none;
    }
    .content-section.active {
      display: block;
    }
    iframe {
      width: 100%;
      height: 500px;
      border: none;
      border-radius: 10px;
      margin-top: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
    }
    button {
      margin: 3px;
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: 0.3s;
    }
    button:hover {
      background: #4ecdc4;
      color: #000;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 13px;
    }
    th, td {
      border: 1px solid #444;
      padding: 6px;
      text-align: left;
    }
    th {
      background: #4ecdc4;
      color: #000;
    }
    .loading {
      text-align: center;
      padding: 20px;
    }
  </style>
</head>
<body>

<header>üì∫ Japan TV Streaming (Live + EPG)</header>

<div class="tabs">
  <div class="tab active" data-tab="tokyo">Tokyo</div>
  <div class="tab" data-tab="kansai">Kansai</div>
  <div class="tab" data-tab="bs">BS</div>
  <div class="tab" data-tab="cs">CS</div>
  <div class="tab" data-tab="epg">EPG ‡∏£‡∏ß‡∏°</div>
</div>

<div class="content">
  <!-- Tokyo -->
  <div class="content-section active" id="tokyo-content">
    <h3>üì° Tokyo Âú∞‰∏äÊ≥¢</h3>
    <div>
      <button onclick="playChannel('https://mt01.utako.moe/NHK_G/index.m3u8','nhk_g_tokyo')">NHK G</button>
      <button onclick="playChannel('https://mt01.utako.moe/NHK_E/index.m3u8','nhk_e_tokyo')">NHK E</button>
      <button onclick="playChannel('https://mt01.utako.moe/Nippon_TV/index.m3u8','ntv')">NTV</button>
      <button onclick="playChannel('https://mt01.utako.moe/TBS/index.m3u8','tbs')">TBS</button>
      <button onclick="playChannel('https://mt01.utako.moe/Fuji_TV/index.m3u8','fuji_tv')">Fuji TV</button>
      <button onclick="playChannel('https://mt01.utako.moe/TV_Asahi/index.m3u8','tv_asahi')">TV Asahi</button>
      <button onclick="playChannel('https://mt01.utako.moe/TV_Tokyo/index.m3u8','tv_tokyo')">TV Tokyo</button>
    </div>
    <iframe id="player" src="" allowfullscreen></iframe>
    <div id="channel-epg"></div>
  </div>

  <!-- Kansai -->
  <div class="content-section" id="kansai-content">
    <h3>üì° Kansai Âú∞‰∏äÊ≥¢</h3>
    <div>
      <button onclick="playChannel('https://mt01.utako.moe/NHK_G_osaka/index.m3u8','nhk_g_osaka')">NHK G (Osaka)</button>
      <button onclick="playChannel('https://mt01.utako.moe/Nippon_TV_osaka/index.m3u8','ytv')">Yomiuri TV</button>
      <button onclick="playChannel('https://mt01.utako.moe/MBS/index.m3u8','mbs')">MBS</button>
      <button onclick="playChannel('https://mt01.utako.moe/KTV/index.m3u8','ktv')">KTV</button>
      <button onclick="playChannel('https://mt01.utako.moe/ABC/index.m3u8','abc')">ABC</button>
      <button onclick="playChannel('https://mt01.utako.moe/TV_Osaka/index.m3u8','tvo')">TV Osaka</button>
    </div>
    <iframe id="player-kansai" src="" allowfullscreen></iframe>
    <div id="channel-epg-kansai"></div>
  </div>

  <!-- BS -->
  <div class="content-section" id="bs-content">
    <h3>üì° BS ÊîæÈÄÅ</h3>
    <div>
      <button onclick="playChannel('https://mt01.utako.moe/BS_TBS/index.m3u8','bs-tbs')">BS-TBS</button>
      <button onclick="playChannel('https://mt01.utako.moe/BS_Fuji/index.m3u8','bs-fuji')">BS Fuji</button>
      <button onclick="playChannel('https://mt01.utako.moe/BS_TV_Tokyo/index.m3u8','bs-tvtokyo')">BS TV Tokyo</button>
      <button onclick="playChannel('https://mt01.utako.moe/BS_Nippon/index.m3u8','bs-ntv')">BS NTV</button>
      <button onclick="playChannel('https://mt01.utako.moe/WOWOW_Prime/index.m3u8','wowow-prime')">WOWOW Prime</button>
      <button onclick="playChannel('https://mt01.utako.moe/WOWOW_Live/index.m3u8','wowow-live')">WOWOW Live</button>
      <button onclick="playChannel('https://mt01.utako.moe/WOWOW_Cinema/index.m3u8','wowow-cinema')">WOWOW Cinema</button>
    </div>
    <iframe id="player-bs" src="" allowfullscreen></iframe>
    <div id="channel-epg-bs"></div>
  </div>

  <!-- CS -->
  <div class="content-section" id="cs-content">
    <h3>üì° CS ÊîæÈÄÅ</h3>
    <div>
      <button onclick="playChannel('https://mt01.utako.moe/Animax/index.m3u8','animax')">Animax</button>
      <button onclick="playChannel('https://mt01.utako.moe/AT-X/index.m3u8','at-x')">AT-X</button>
      <button onclick="playChannel('https://mt01.utako.moe/Disney_Channel/index.m3u8','disneych')">Disney Channel</button>
      <button onclick="playChannel('https://mt01.utako.moe/NHK_World/index.m3u8','nhk-world')">NHK World</button>
      <button onclick="playChannel('https://mt01.utako.moe/Green_Channel/index.m3u8','green-ch')">Green Channel</button>
      <button onclick="playChannel('https://mt01.utako.moe/GAORA/index.m3u8','gaora')">GAORA</button>
      <button onclick="playChannel('https://mt01.utako.moe/J_Sports_1/index.m3u8','jsports1')">J Sports 1</button>
      <button onclick="playChannel('https://mt01.utako.moe/J_Sports_2/index.m3u8','jsports2')">J Sports 2</button>
      <button onclick="playChannel('https://mt01.utako.moe/J_Sports_3/index.m3u8','jsports3')">J Sports 3</button>
      <button onclick="playChannel('https://mt01.utako.moe/J_Sports_4/index.m3u8','jsports4')">J Sports 4</button>
    </div>
    <iframe id="player-cs" src="" allowfullscreen></iframe>
    <div id="channel-epg-cs"></div>
  </div>

  <!-- EPG ‡∏£‡∏ß‡∏° -->
  <div class="content-section" id="epg-content">
    <h3>üìÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏±‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏° (EPG)</h3>
    <div id="epg-table"></div>
  </div>
</div>

<script>
  // ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏ó‡πá‡∏ö
  document.querySelectorAll(".tab").forEach(tab => {
    tab.addEventListener("click", () => {
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      tab.classList.add("active");

      document.querySelectorAll(".content-section").forEach(sec => sec.classList.remove("active"));
      document.getElementById(tab.dataset.tab + "-content").classList.add("active");
    });
  });

  // ‡πÇ‡∏´‡∏•‡∏î EPG
  async function loadEPG(channelId = null, target = "epg-table") {
    const urls = [
      "https://epg.freejptv.com/jp.xml",
      "https://animenosekai.github.io/japanterebi-xmltv/guide.xml"
    ];
    const epgTable = document.getElementById(target);
    epgTable.innerHTML = "<div class='loading'>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î EPG...</div>";

    try {
      const responses = await Promise.all(urls.map(url => fetch(url)));
      const texts = await Promise.all(responses.map(r => r.text()));
      let parser = new DOMParser();
      let programs = [];

      texts.forEach(txt => {
        const xml = parser.parseFromString(txt, "application/xml");
        const items = xml.querySelectorAll("programme");
        items.forEach(prog => {
          programs.push({
            start: prog.getAttribute("start"),
            stop: prog.getAttribute("stop"),
            channel: prog.getAttribute("channel"),
            title: prog.querySelector("title")?.textContent || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",
            desc: prog.querySelector("desc")?.textContent || ""
          });
        });
      });

      programs.sort((a,b) => new Date(a.start) - new Date(b.start));

      let html = `<table><tr><th>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</th><th>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡∏¥‡∏Å</th><th>‡∏ä‡πà‡∏≠‡∏á</th><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th></tr>`;
      const today = new Date().toISOString().slice(0,10).replace(/-/g,"");

      programs.forEach(p => {
        if (p.start.startsWith(today) && (!channelId || p.channel === channelId)) {
          html += `<tr>
            <td>${p.start}</td>
            <td>${p.stop}</td>
            <td>${p.channel}</td>
            <td>${p.title}<br><small>${p.desc}</small></td>
          </tr>`;
        }
      });
      html += "</table>";
      epgTable.innerHTML = html;

    } catch (err) {
      epgTable.innerHTML = "<div class='loading'>‡πÇ‡∏´‡∏•‡∏î EPG ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</div>";
    }
  }

  function playChannel(url, id) {
    // ‡∏´‡∏≤ iframe ‡∏ó‡∏µ‡πà active
    let iframe = document.querySelector(".content-section.active iframe");
    let epgDiv = document.querySelector(".content-section.active div[id^='channel-epg']");
    iframe.src = url;
    loadEPG(id, epgDiv.id);
  }

  // ‡πÇ‡∏´‡∏•‡∏î EPG ‡∏£‡∏ß‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡πÅ‡∏ó‡πá‡∏ö
  document.querySelector('[data-tab="epg"]').addEventListener("click", () => loadEPG());
</script>

</body>
</html>
